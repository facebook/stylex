---
# Copyright (c) Meta Platforms, Inc. and affiliates.
#
# This source code is licensed under the MIT license found in the
# LICENSE file in the root directory of this source tree.
sidebar_position: 5
---

# Waku

[`examples/example-waku`](https://github.com/facebook/stylex/tree/main/examples/example-waku) integrates StyleX
into a Waku app through the Vite layer using `@stylexjs/unplugin`. The plugin
compiles StyleX modules, aggregates the generated CSS, and appends it to the
emitted CSS assets so the browser only downloads one stylesheet.

## Waku/Vite configuration

```ts
// waku.config.ts
import react from '@vitejs/plugin-react';
import stylex from '@stylexjs/unplugin';
import { defineConfig } from 'waku/config';

export default defineConfig({
  vite: {
    plugins: [
      stylex.vite({
        useCSSLayers: true,
        devMode: 'css-only',
        devPersistToDisk: true,
        runtimeInjection: false,
      }),
      react({ babel: { plugins: ['babel-plugin-react-compiler'] } }),
    ],
  },
});
```

- `devMode: 'css-only'` serves `/virtual:stylex.css` in dev without injecting
  the JS runtime.
- `devPersistToDisk` lets multiple Waku environments share collected rules while
  developing.

## CSS entry and dev injection

- Import `src/global.css` so Vite always emits a CSS asset. StyleX output is
  appended to that file during builds.
- Use the shared helper to load CSS in dev and prod:
  ```tsx
  // src/components/DevStyleXInject.tsx
  'use client';
  import { useEffect } from 'react';

  function DevStyleXInjectImpl() {
    useEffect(() => {
      if (import.meta.env.DEV) {
        import('virtual:stylex:css-only');
      }
    }, []);
    return <link rel="stylesheet" href="/virtual:stylex.css" />;
  }

  export function DevStyleXInject({ cssHref }: { cssHref: string }) {
    return import.meta.env.DEV ? (
      <DevStyleXInjectImpl />
    ) : (
      <link rel="stylesheet" href={cssHref} />
    );
  }
  ```
  Render `<DevStyleXInject cssHref="/stylex.css" />` near the top of
  `src/pages/_layout.tsx`. The dev link + JS import keep CSS hot reload working,
  and `cssHref` should point to the built StyleX stylesheet (use the pluginâ€™s
  `stylex.css` fallback or your emitted CSS file).

  ```tsx
  // src/pages/_layout.tsx (excerpt)
  import { DevStyleXInject } from '../components/DevStyleXInject';

  export default function RootLayout({ children }: { children: ReactNode }) {
    return (
      <div>
        <DevStyleXInject cssHref="/stylex.css" />
        {children}
      </div>
    );
  }
  ```
