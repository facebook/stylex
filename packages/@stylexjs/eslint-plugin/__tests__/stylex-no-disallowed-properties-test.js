/**
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */

'use strict';

jest.disableAutomock();

const { RuleTester: ESLintTester } = require('eslint');
const rule = require('../src/stylex-no-disallowed-properties');

const eslintTester = new ESLintTester({
  parser: require.resolve('hermes-eslint'),
  parserOptions: {
    ecmaVersion: 6,
    sourceType: 'module',
  },
});

eslintTester.run('stylex-no-disallowed-properties', rule.default, {
  valid: [
    `
      import * as stylex from '@stylexjs/stylex';
      const styles = stylex.create({
        validStyle: {
          accentColor: 'blue',
          alignContent: 'center',
          alignItems: 'center',
          alignmentBaseline: 'baseline',
          alignSelf: 'center',
          animationDelay: '0s',
          animationDirection: 'normal',
          animationDuration: '1s',
          animationFillMode: 'none',
          animationIterationCount: 'infinite',
          animationName: 'none',
          animationPlayState: 'running',
          animationTimingFunction: 'ease',
          appearance: 'none',
          aspectRatio: '16 / 9',
          backdropFilter: 'none',
          backfaceVisibility: 'visible',
          background: 'red',
          backgroundAttachment: 'scroll',
          backgroundBlendMode: 'normal',
          backgroundClip: 'border-box',
          backgroundColor: 'red',
          backgroundImage: 'none',
          backgroundOrigin: 'padding-box',
          backgroundPosition: 'center',
          backgroundPositionX: 'center',
          backgroundPositionY: 'center',
          backgroundRepeat: 'repeat-x',
          backgroundSize: 'cover',
          baselineShift: 'baseline',
          blockSize: 'auto',
          borderBlockColor: 'black',
          borderBlockEndColor: 'black',
          borderBlockEndStyle: 'solid',
          borderBlockEndWidth: '1px',
          borderBlockStartColor: 'black',
          borderBlockStartStyle: 'solid',
          borderBlockStartWidth: '1px',
          borderBlockStyle: 'solid',
          borderBlockWidth: '1px',
          borderBottomColor: 'black',
          borderBottomStyle: 'solid',
          borderBottomWidth: '1px',
          borderCollapse: 'collapse',
          borderColor: 'black',
          borderEndEndRadius: '5px',
          borderEndStartRadius: '5px',
          borderImage: 'none',
          borderImageOutset: 0,
          borderImageRepeat: 'stretch',
          borderImageSlice: '100%',
          borderImageSource: 'none',
          borderImageWidth: '1',
          marginInlineStart: "10px",
          marginInlineEnd: "5px",
          marginInline: "15px",
          marginBlock: "20px",
          borderInlineColor: 'black',
          borderInlineEndColor: 'black',
          borderInlineEndStyle: 'solid',
          borderInlineEndWidth: '1px',
          borderInlineStartColor: 'black',
          borderInlineStartStyle: 'solid',
          borderInlineStartWidth: '1px',
          borderInlineStyle: 'solid',
          borderInlineWidth: '1px',
          borderRadius: '5px',
          borderSpacing: 0,
          borderStartEndRadius: '5px',
          borderStartStartRadius: '5px',
          borderStyle: 'solid',
          borderTopColor: 'black',
          borderTopStyle: 'solid',
          borderTopWidth: '1px',
          borderWidth: '1px',
          bottom: 0,
          boxAlign: 'start',
          boxDecorationBreak: 'slice',
          boxDirection: 'normal',
          boxFlex: 0,
          boxFlexGroup: 0,
          boxLines: 'single',
          boxOrdinalGroup: 0,
          boxOrient: 'horizontal',
          boxShadow: 'none',
          boxSizing: 'border-box',
          boxSuppress: 'show',
          breakAfter: 'auto',
          breakBefore: 'auto',
          breakInside: 'auto',
          captionSide: 'top',
          caretColor: 'auto',
          clear: 'none',
          clip: 'auto',
          clipPath: 'none',
          clipRule: 'nonzero',
          color: 'black',
          colorScheme: 'initial',
          columnCount: 'auto',
          columnFill: 'auto',
          columnGap: 'normal',
          columnRule: '1px solid black',
          columnRuleColor: 'black',
          columnRuleStyle: 'solid',
          columnRuleWidth: '1px',
          columns: 'auto',
          columnSpan: 'none',
          columnWidth: 'auto',
          contain: 'none',
          containerName: 'none',
          containerType: 'normal',
          containIntrinsicBlockSize: 'none',
          containIntrinsicInlineSize: 'none',
          containIntrinsicSize: 'none',
          content: 'normal',
          contentVisibility: 'visible',
          counterIncrement: 'none',
          counterReset: 'none',
          counterSet: 'none',
          cue: 'none',
          cueAfter: 'none',
          cueBefore: 'none',
          cursor: 'auto',
          direction: 'ltr',
          display: 'block',
          dominantBaseline: 'auto',
          emptyCells: 'show',
          fill: 'black',
          fillOpacity: '1',
          fillRule: 'nonzero',
          filter: 'none',
          flex: 'none',
          flexBasis: 'auto',
          flexDirection: 'row',
          flexGrow: 0,
          flexShrink: '1',
          flexWrap: 'nowrap',
          float: 'none',
          font: 'normal normal normal 16px sans-serif',
          fontFamily: 'sans-serif',
          fontFeatureSettings: 'normal',
          fontKerning: 'auto',
          fontLanguageOverride: 'normal',
          fontOpticalSizing: 'auto',
          fontPalette: 'normal',
          fontSize: '16px',
          fontSizeAdjust: 'none',
          fontStretch: 'normal',
          fontStyle: 'normal',
          fontSynthesis: 'none',
          fontVariant: 'normal',
          fontVariantAlternates: 'normal',
          fontVariantCaps: 'normal',
          fontVariantEastAsian: 'normal',
          fontVariantLigatures: 'normal',
          fontVariantNumeric: 'normal',
          fontVariantPosition: 'normal',
          fontVariationSettings: 'normal',
          fontWeight: 'normal',
          forcedColorAdjust: 'auto',
          glyphOrientationHorizontal: 0,
          glyphOrientationVertical: 0,
          paddingInlineStart: "8px",
          paddingInlineEnd: "12px",
          paddingInline: "10px",
          paddingBlock: "16px",
          hangingPunctuation: 'none',
          height: 'auto',
          hyphenateCharacter: 'auto',
          hyphens: 'manual',
          imageOrientation: 'from-image',
          imageRendering: 'auto',
          imageResolution: '1dppx',
          imeMode: 'auto',
          initialLetter: 'normal',
          initialLetterAlign: 'auto',
          inlineSize: 'auto',
          inset: 0,
          insetBlock: 0,
          insetBlockEnd: 0,
          insetBlockStart: 0,
          insetInline: 0,
          insetInlineEnd: 0,
          insetInlineStart: 0,
          isolation: 'auto',
          justifyContent: 'flex-start',
          justifyItems: 'normal',
          justifySelf: 'auto',
          kerning: 'auto',
          letterSpacing: 'normal',
          lineBreak: 'auto',
          lineHeight: 'normal',
          listStyle: 'none',
          listStyleImage: 'none',
          listStylePosition: 'outside',
          listStyleType: 'disc',
          margin: 0,
          marginBlock: 0,
          marginBlockEnd: 0,
          marginBlockStart: 0,
          marginBottom: 0,
          marginInline: 0,
          marginInlineEnd: 0,
          marginInlineStart: 0,
          marginTop: 0,
          marker: 'none',
          markerEnd: 'none',
          markerMid: 'none',
          markerOffset: 'auto',
          markerStart: 'none',
          mask: 'none',
          maxBlockSize: 'none',
          maxHeight: 'none',
          maxInlineSize: 'none',
          maxWidth: 'none',
          minBlockSize: 'auto',
          minHeight: 'auto',
          minInlineSize: 'auto',
          minWidth: 'auto',
          mixBlendMode: 'normal',
          motion: 'none',
          motionOffset: 0,
          motionPath: 'none',
          motionRotation: '0deg',
          objectFit: 'fill',
          objectPosition: '50% 50%',
          offsetAnchor: 'auto',
          offsetDistance: 0,
          offsetPath: 'none',
          offsetRotate: 'auto',
          opacity: '1',
          order: 0,
          orphans: '2',
          outline: 'none',
          outlineColor: 'black',
          outlineOffset: '0px',
          outlineStyle: 'none',
          outlineWidth: '1px',
          overflow: 'visible',
          overflowAnchor: 'auto',
          overflowClipMargin: '0px',
          overflowWrap: 'normal',
          overflowX: 'visible',
          overflowY: 'visible',
          overscrollBehavior: 'auto',
          overscrollBehaviorX: 'auto',
          overscrollBehaviorY: 'auto',
          padding: 0,
          paddingBlock: 0,
          paddingBlockEnd: 0,
          paddingBlockStart: 0,
          paddingBottom: 0,
          paddingInline: 0,
          paddingInlineEnd: 0,
          paddingInlineStart: 0,
          paddingTop: 0,
          pageBreakAfter: 'auto',
          pageBreakBefore: 'auto',
          pageBreakInside: 'auto',
          paintOrder: 'normal',
          pause: 'none',
          pauseAfter: 'none',
          pauseBefore: 'none',
          perspective: 'none',
          perspectiveOrigin: '50% 50%',
          placeContent: 'normal',
          placeItems: 'normal',
          pointerEvents: 'auto',
          position: 'static',
          printColorAdjust: 'economy',
          quotes: 'auto',
          resize: 'none',
          rest: 'none',
          restAfter: 'none',
          restBefore: 'none',
          rotate: 'none',
          rowGap: 0,
          rubyAlign: 'space-around',
          rubyMerge: 'separate',
          rubyPosition: 'over',
          scale: 'none',
          scrollbarColor: 'auto',
          scrollbarWidth: 'auto',
          scrollBehavior: 'auto',
          scrollMarginBlockEnd: 0,
          scrollMarginBlockStart: 0,
          scrollMarginBottom: 0,
          scrollMarginInlineEnd: 0,
          scrollMarginInlineStart: 0,
          scrollMarginLeft: 0,
          scrollMarginRight: 0,
          scrollMarginTop: 0,
          scrollPaddingBlockEnd: 0,
          scrollPaddingBlockStart: 0,
          scrollPaddingBottom: 0,
          scrollPaddingInlineEnd: 0,
          scrollPaddingInlineStart: 0,
          scrollPaddingLeft: 0,
          scrollPaddingRight: 0,
          scrollPaddingTop: 0,
          scrollSnapAlign: 'none',
          scrollSnapStop: 'normal',
          scrollSnapType: 'none',
          shapeImageThreshold: 0,
          shapeMargin: 0,
          shapeOutside: 'none',
          shapeRendering: 'auto',
          speak: 'auto',
          speakAs: 'normal',
          src: 'none',
          stroke: 'none',
          strokeDasharray: 'none',
          strokeDashoffset: 0,
          strokeLinecap: 'butt',
          strokeLinejoin: 'miter',
          strokeMiterlimit: '4',
          strokeOpacity: '1',
          strokeWidth: '1',
          tabSize: '8',
          textAlign: 'start',
          textAlignLast: 'auto',
          textAnchor: 'start',
          textCombineUpright: 'none',
          textDecorationSkip: 'objects',
          textDecorationSkipInk: 'auto',
          textDecorationThickness: 'unset',
          textEmphasis: 'none',
          textEmphasisColor: 'currentColor',
          textEmphasisPosition: 'over right',
          textEmphasisStyle: 'none',
          textFillColor: 'currentColor',
          textIndent: 0,
          textOrientation: 'mixed',
          textOverflow: 'clip',
          textRendering: 'auto',
          textShadow: 'none',
          textSizeAdjust: 'auto',
          textTransform: 'none',
          textUnderlineOffset: 'auto',
          textUnderlinePosition: 'auto',
          textWrap: 'wrap',
          top: 0,
          touchAction: 'auto',
          transform: 'none',
          transformBox: 'view-box',
          transformOrigin: '50% 50%',
          transformStyle: 'flat',
          transition: 'none',
          transitionDelay: '0s',
          transitionDuration: '0s',
          transitionProperty: 'opacity',
          transitionTimingFunction: 'ease',
          translate: 'none',
          unicodeBidi: 'normal',
          unicodeRange: 'U+0-10FFFF',
          userSelect: 'auto',
          verticalAlign: 'baseline',
          viewTransitionName: 'none',
          visibility: 'visible',
          voiceBalance: 'center',
          voiceDuration: 'auto',
          voiceFamily: 'default',
          voicePitch: 'medium',
          voiceRange: 'medium',
          voiceRate: 'normal',
          voiceStress: 'normal',
          voiceVolume: 'medium',
          whiteSpace: 'normal',
          widows: '2',
          width: 'auto',
          willChange: 'auto',
          wordBreak: 'normal',
          wordSpacing: 'normal',
          wordWrap: 'normal',
          writingMode: 'horizontal-tb',
          zIndex: 'auto',
        },
      });
    `,
    // test for allowed raw CSS variable overrides
    {
      code: `
        import * as stylex from '@stylexjs/stylex';
        const styles = stylex.create({
          foo: {
            '--bar': 0,
          }
        })
      `,
      options: [{ allowRawCSSVars: true }],
    },
  ],
  invalid: [
    {
      code: `
      import * as stylex from '@stylexjs/stylex';
      stylex.create({
        default: {
          ':hover': {
            textAlin: 'left'
          },
        },
      });
      `,
      errors: [
        {
          message: 'This is not a key that is allowed by stylex',
        },
      ],
    },
    {
      code: `
import * as stylex from '@stylexjs/stylex';
stylex.create({
  default: {
    textAlin: 'left',
  },
});`,
      errors: [
        {
          message: 'This is not a key that is allowed by stylex',
          suggestions: [
            {
              desc: 'Did you mean "textAlign"?',
              output: `
import * as stylex from '@stylexjs/stylex';
stylex.create({
  default: {
    textAlign: 'left',
  },
});`,
            },
          ],
        },
      ],
    },
    {
      code: `
      import * as stylex from '@stylexjs/stylex';
      stylex.create({
        borders: {
          borderBlock: '1px solid black',
          borderInline: '1px solid black',
          borderEndColor: 'black',
          borderEndStyle: 'solid',
          borderEndWidth: 1,
          borderStartColor: 'black',
          borderStartStyle: 'solid',
          borderStartWidth: 1,
        },
        fonts: {
          fontSynthesisPosition: 'auto',
          fontSynthesisSmallCaps: 'auto',
          fontSynthesisStyle: 'auto',
          fontSynthesisWeight: 'auto',
        },
        nonStandard: {
          end: 0,
          marginEnd: 0,
          marginHorizontal: 0,
          marginStart: 0,
          marginVertical: 0,
          paddingEnd: 0,
          paddingHorizontal: 0,
          paddingStart: 0,
          paddingVertical: 0,
          start: 0,
        },
        others: {
          caret: 'auto',
          caretShape: 'auto',
          containIntrinsicHeightSize: 'none',
          containIntrinsicWidthSize: 'none',
          container: 'none',
          hyphenateLimitChars: 'auto',
          lineHeightStep: 0,
          marginTrim: 'none',
          maskBorder: 'none',
          mathDepth: 0,
          mathShift: 'normal',
          mathStyle: 'normal',
          offset: 'none',
          offsetPosition: 'auto',
          overflowBlock: 'visible',
          overflowBlockX: 'visible',
          overscrollBehaviorBlock: 'auto',
          overscrollBehaviorInline: 'auto',
          page: 'auto',
          scrollMargin: 0,
          scrollMarginBlock: 0,
          scrollMarginInline: 0,
          scrollPadding: 0,
          scrollPaddingBlock: 0,
          scrollPaddingInline: 0,
          scrollTimeline: 'none',
          scrollTimelineAxis: 'block',
          scrollTimelineName: 'none',
          textJustify: 'auto',
          theme: 'none',
          timelineScope: 'none',
          viewTimeline: 'none',
          viewTimelineAxis: 'block',
          viewTimelineInset: 'auto',
          viewTimelineName: 'none',
        },
      });`,
      errors: new Array(57).fill(null).map(() => ({
        message: 'This is not a key that is allowed by stylex',
      })),
    },
    {
      code: "import * as stylex from '@stylexjs/stylex'; stylex.create({default: {textAlin: 'left'}});",
      errors: [
        {
          message: 'This is not a key that is allowed by stylex',
          suggestions: [
            {
              desc: 'Did you mean "textAlign"?',
              output:
                "import * as stylex from '@stylexjs/stylex'; stylex.create({default: {textAlign: 'left'}});",
            },
          ],
        },
      ],
    },
    {
      code: `
import * as stylex from '@stylexjs/stylex';
stylex.create({
  default: {
    ["textAlin"]: 'left',
  },
});`,
      errors: [
        {
          message: 'This is not a key that is allowed by stylex',
          suggestions: [
            {
              desc: 'Did you mean "textAlign"?',
              output: `
import * as stylex from '@stylexjs/stylex';
stylex.create({
  default: {
    ["textAlign"]: 'left',
  },
});`,
            },
          ],
        },
      ],
    },
    {
      code: `
        import * as stylex from '@stylexjs/stylex';
        const styles = stylex.create({
          foo: {
            '--bar': 0,
          }
        })
      `,
      options: [{ allowRawCSSVars: false }],
      errors: [
        {
          message: 'This is not a key that is allowed by stylex',
        },
      ],
    },
  ],
});
